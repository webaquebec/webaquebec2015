!function(t){window.sticky={selection:[]},$win=t(window),cloneForResize=function(t){var e=t.clone();return e[0].style.visibility="hidden",e[0].style.marginBottom="-"+e.outerHeight()+"px",e},updateContainedOffset=function(e){for(var o=e.data&&e.data.$selection?e.data.$selection:e,n=0;n<o.length;n++){var s=o[n],i=t(s);if(s.stickyAlreadyUpdating)return;for(var r=0;r<s.scrollEvents.length;r++)if("sticked"==s.scrollEvents[r].flag)var f=s.scrollEvents[r];if(f){s.$stickyClone.insertBefore(i);var l=s.$stickyClone.position();s.$stickyClone[0].style.width=s.$stickyClone.outerWidth()+"px",s.$stickyClone[0].style.position="absolute",s.$stickyClone[0].style.top=l.top+"px",s.$stickyClone[0].style.left=l.left+"px",s.stickyAlreadyUpdating=!0,window.raf.on("nextframe",{$el:i},function(t){var e=t.data.$el,o=e[0];if(o.$stickyClone){for(var n=o.$stickyClone.outerHeight(),s=f.container.outerHeight(),i=e.scrollEvents("get","sticked"),r=e.scrollEvents("get","contained"),c=n>s-f.offset-f.offsetBottom-l.top,t=0;t<i.length;t++)c&&!i[0].disabled&&i[t].reset&&i[t].reset(i[t]);i.length&&i[0].disabled==!c&&e.scrollEvents(c?"disable":"enable","sticked"),r.length&&r[0].disabled==!c&&e.scrollEvents(c?"disable":"enable","contained"),e.scrollEvents("set","contained",{offset:-(s-l.top-n-f.offsetBottom)+f.offset}),o.$stickyClone.remove(),o.stickyAlreadyUpdating=null}})}}},resetSticky=function(e){for(var o=0;o<e.length;o++){for(var n=e[o],s=(t(n),0);s<n.scrollEvents.length;s++)if("sticked"==n.scrollEvents[s].flag)var i=n.scrollEvents[s];i&&i.reset(i)}},getStickys=function(e){for(var o=t(),n=0;n<e.length;n++){var s=window.sticky.selection.indexOf(e[n]);s>-1&&o.push(window.sticky.selection[s])}return o},pushStickys=function(t){for(var e=0;e<t.length;e++)window.sticky.selection.push(t[e])},setRafref=function(t,e){for(var o=0;o<e.length;o++)e[o].stickyRafref=t},getRafref=function(t){for(var e=[],o=0;o<t.length;o++){var n=t[o].stickyRafref,s=e.indexOf(n);-1==s&&e.push(n)}return e},t.extend(t.fn,{sticky:function(e,o){var n=t(this);if("string"==typeof e){var n=getStickys(n);if("update"==e&&updateContainedOffset(n),"destroy"==e){resetSticky(n);for(var s=getRafref(n),i=0;i<s.length;i++)window.raf.off(s[i],"afterdocumentresize",updateContainedOffset)}return t(this).scrollEvents(e,o)}var o=t.extend(!0,{container:!1,inverted:!1,offset:0,offsetBottom:0,reset:null,fixed:null,contained:null,fixedTop:null,fixedBottom:null,scrolling:null},e);if(o.inverted)n.scrollEvents({order:2,flag:"inverted sticky top",offset:o.offset,topUp:o.fixedTop,options:o}),n.scrollEvents({order:1,flag:"scrolling top",offset:o.offset,topDown:o.scrolling,options:o}),n.scrollEvents({order:1,flag:"scrolling bottom",offsetBottom:o.offsetBottom,bottomUp:o.scrolling,options:o}),n.scrollEvents({order:2,flag:"inverted sticky bottom",offsetBottom:o.offsetBottom,bottomDown:o.fixedBottom,options:o});else{for(var r=0;r<n.length;r++){var f=t(n[r]);f.scrollEvents({order:2,flag:"sticked",container:o.container,offset:o.offset,offsetBottom:o.offsetBottom,topDown:o.reset,topUp:o.fixed,reset:o.reset,options:o}),o.container&&(f[0].$stickyClone=cloneForResize(f),f.scrollEvents({order:1,flag:"contained",offset:-(o.container.outerHeight()-f.position().top-f.outerHeight()-o.offsetBottom)+o.offset,container:o.container,topDown:o.fixed,topUp:o.contained,options:o}))}if(o.container){updateContainedOffset(n);var l=window.raf.on("afterdocumentresize",{$selection:n},updateContainedOffset).ref;setRafref(l,n)}}pushStickys(n)}}),$win.on("load",function(){updateContainedOffset(t(window.sticky.selection))})}(jQuery);